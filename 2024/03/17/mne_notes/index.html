<!DOCTYPE HTML>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>MNE Python Notes | Voidhead</title>
  <meta name="author" content="Ariax">
  
  <meta name="description" content="EEG ANALYSIS WITH MNE
  **Disclaimer**
  
    This post includes codes extracted or modified from referenced articles for educational purposes. If there are any copyright issues, please contact the author for removal.
  


Official tutorial
ConceptsECG, EEG, EMG, EOG
MEG, STI
gradiometers, magnetometers
Launch MNEanaconda nav

powershell

conda activate mne

jupyter lab

Work with continuous data">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="MNE Python Notes"/>
  <meta property="og:site_name" content="Voidhead"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70812759-1', 'auto');
  ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?cb5448498d7169c668b07c2b255d62c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="Voidhead" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

 <body>  
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Voidhead</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/links" title="Friends">
			  <i class=""></i>Friends
			</a>
		  </li>
		  
		  <li>
			<a href="/misc" title="Miscs">
			  <i class=""></i>Misc
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> MNE Python Notes</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h1 id="EEG-ANALYSIS-WITH-MNE"><a href="#EEG-ANALYSIS-WITH-MNE" class="headerlink" title="EEG ANALYSIS WITH MNE"></a>EEG ANALYSIS WITH MNE</h1><div class="container">
  **Disclaimer**
  <div class="disclaimer">
    <p>This post includes codes extracted or modified from referenced articles for educational purposes. If there are any copyright issues, please contact the author for removal.</p>
  </div>
</div>

<p><a target="_blank" rel="noopener" href='https://mne.tools/stable/auto_tutorials/index.html'>Official tutorial</a></p>
<h3 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h3><p><a target="_blank" rel="noopener" href='https://www.sensortips.com/featured/what-is-the-difference-between-an-ecg-eeg-emg-and-eog/'>ECG, EEG, EMG, EOG</a></p>
<p>MEG, STI</p>
<p>gradiometers, magnetometers</p>
<h2 id="Launch-MNE"><a href="#Launch-MNE" class="headerlink" title="Launch MNE"></a>Launch MNE</h2><pre><code>anaconda nav

powershell

conda activate mne

jupyter lab
</code></pre>
<h2 id="Work-with-continuous-data"><a href="#Work-with-continuous-data" class="headerlink" title="Work with continuous data"></a>Work with continuous data</h2><h4 id="Processing-raws"><a href="#Processing-raws" class="headerlink" title="Processing raws"></a>Processing raws</h4><p>REF: </p>
<p>import needed packages:</p>
<pre class="line-numbers language-none"><code class="language-none">import matplotlib

import pathlib

import mne<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>set storage location:</p>
<pre><code>sample_data_dir = mne.datasets.sample.data_path()

# Convert to a pathlib.Path for more convenience
sample_data_dir = pathlib.Path(sample_data_dir)
sample_data_dir
</code></pre>
<p>Then use <code>.plot()</code> to visualize them!</p>
<h4 id="Working-with-events"><a href="#Working-with-events" class="headerlink" title="Working with events"></a>Working with events</h4><p>REF: WORKLAB NOTEBOOK #1</p>
<p>Converting raw data into events, naming, and extracting them aims to enhance data comprehension and analysis</p>
<p>Extract events:</p>
<pre><code>events = mne.find_events(raw)

event_id = &#123;
&#39;Auditory/Left&#39;: 1,
&#39;Auditory/Right&#39;: 2,
&#39;Visual/Left&#39;: 3,
&#39;Visual/Right&#39;: 4,
&#39;Smiley&#39;: 5,
&#39;Button&#39;: 32
&#125;

len(events[events[:, 2] == 32])
len(events[events[:, 2]==4])+len(events[events[:, 2]==3])
</code></pre>
<p>Mark channels as bad:<br><code>raw.info['bads'&#125;+=['EEG 051']</code></p>
<p>Or just manually perform it after visualizing them.</p>
<h4 id="Crop-amp-Filter"><a href="#Crop-amp-Filter" class="headerlink" title="Crop &amp; Filter"></a>Crop &amp; Filter</h4><p>REF: WORKSHOP NOTEBOOK #1</p>
<p>Selecting specific portions of the raw data based on predefined criteria or parameters, such as time range, location, or data type, to extract relevant subsets for further analysis.</p>
<p>NOTE: It’s a diffrent process from “cleaning”.</p>
<p>Sample code:<br><code></p>
<pre><code>import matplotlib.pyplot as plt

fig, ax = plt.subplots(2)

raw_eeg_cropped.plot_psd(ax=ax[0], show=False)
raw_eeg_cropped_filtered.plot_psd(ax=ax[1], show=False)

ax[0].set_title(&#39;PSD before filtering&#39;)
ax[1].set_title(&#39;PSD after filtering&#39;)
ax[1].set_xlabel(&#39;Frequency (Hz)&#39;)
fig.set_tight_layout(True)
plt.show()
</code></pre>
</code>

<p>Output:<br><img src="/img/psd1.jpeg"><br><img src="/img/psd2.jpeg"></p>
<h2 id="BIDS-Brain-image-data-structure"><a href="#BIDS-Brain-image-data-structure" class="headerlink" title="BIDS(Brain image data structure)"></a>BIDS(Brain image data structure)</h2><p>Write raw data to BIDS:</p>
<code>

<pre><code>raw.info[&#39;line_freq&#39;] = 60
subject_info = &#123;
&#39;birthday&#39;:(1996,10,1),
&#39;sex&#39;:2,
&#39;hand&#39;:3
&#125;

raw.info[&#39;subject_info&#39;] = subject_info
raw.info
</code></pre>
</code>

<p>Reading BIDS data:</p>
<code>

<pre><code>bids_root = pathlib.Path(&#39;out_data/sample_BIDS&#39;)

bids_path = mne_bids.BIDSPath(subject=&#39;01&#39;,
                          session=&#39;01&#39;,
                          task=&#39;audiovisual&#39;,
                          run=&#39;01&#39;,
                          datatype=&#39;meg&#39;,
                          root=bids_root)

raw = mne_bids.read_raw_bids(bids_path)
</code></pre>
</code>

<h2 id="EPOCH-amp-EVOKED-Uncontinuous-data"><a href="#EPOCH-amp-EVOKED-Uncontinuous-data" class="headerlink" title="EPOCH &amp; EVOKED - Uncontinuous data"></a>EPOCH &amp; EVOKED - Uncontinuous data</h2><p>REF: NOTEBOOK #3<br><a target="_blank" rel="noopener" href='https://mp.weixin.qq.com/s/eJz5a1Up8fST0P1AcNs6Ig'>脑机接口社区 (Chinese)</a></p>
<p>EPOCH: Signals contracted from continuous EEG signals, divided by time spans. In MNE, EPOCH acts as a method marking continuous assets as time span assets.</p>
<p>To build EPOCH:</p>
<pre class="line-numbers language-none"><code class="language-none">    # Firstly preprocess the raws
    # Divided into events and then
tmin &#x3D; -0.3
tmax &#x3D; 0.5
baseline &#x3D; (None, 0)

epochs &#x3D; mne.Epochs(raw,
                    events&#x3D;events,
                    event_id&#x3D;event_id,
            tmin&#x3D;tmin,
                    tmax&#x3D;tmax,
                    baseline&#x3D;baseline,
                    preload&#x3D;True)
epochs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">Output:

Not setting metadata
320 matching events found
Setting baseline interval to [-0.2996928197375818, 0.0] s
Applying baseline correction (mode: mean)
Created an SSP operator (subspace dimension &#x3D; 3)
3 projection items activated
Using data from preloaded Raw for 320 events and 481 original time points ...
0 bad epochs dropped
Number of events	320
Events	Auditory&#x2F;Left: 72
Auditory&#x2F;Right: 73
Button: 16
Smiley: 15
Visual&#x2F;Left: 73
Visual&#x2F;Right: 71
Time range	-0.300 – 0.499 s
Baseline	-0.300 – 0.000 s
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Also we can select epochs based on experimental criterias</p>
<pre class="line-numbers language-none"><code class="language-none">epochs[&#39;Right&#39;].copy().pick_types(meg&#x3D;False,eeg&#x3D;True).plot_image()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Remember to first build <code>events</code></p>
<p>EVOKED:  “Evoked Potential (EP)” refers to specific patterns of electrical potentials recorded from the nervous system, particularly specific areas of the brain, in humans or other animals, following stimuli such as flashes or pure tones. The potentials are usually low, thus it’s common practice to average them.</p>
<p>Creating EVOKED from EPOCHS:</p>
<pre class="line-numbers language-none"><code class="language-none">evoked_auditory &#x3D; epochs[&#39;Auditory&#39;].average()
evoked_visual &#x3D; epochs[&#39;Visual&#39;].average()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Reading EVOKED data:</p>
<pre class="line-numbers language-none"><code class="language-none">evokeds &#x3D; mne.read_evokeds(fname&#x3D;pathlib.Path(&#39;out_data&#39;) &#x2F; &#39;evokeds_ave.fif&#39;)
evokeds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Draw Global Field Power(GFP)</p>
<p>Draw EVOKED</p>
<h3 id="Epoched-data-cleaning"><a href="#Epoched-data-cleaning" class="headerlink" title="Epoched data cleaning"></a>Epoched data cleaning</h3><p>Same thing, preprocess raws first</p>
<p>Then reject artifacts</p>
<pre class="line-numbers language-none"><code class="language-none">reject_criteria &#x3D; dict(mag&#x3D;3000e-15,     # 3000 fT
                       grad&#x3D;3000e-13,    # 3000 fT&#x2F;cm
                       eeg&#x3D;150e-6,       # 150 µV
                       eog&#x3D;200e-6)       # 200 µV

flat_criteria &#x3D; dict(mag&#x3D;1e-15,          # 1 fT
                     grad&#x3D;1e-13,         # 1 fT&#x2F;cm
                     eeg&#x3D;1e-6)           # 1 µV

epochs.drop_bad(reject&#x3D;reject_criteria, flat&#x3D;flat_criteria)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="SSP-amp-ICA"><a href="#SSP-amp-ICA" class="headerlink" title="SSP &amp; ICA"></a>SSP &amp; ICA</h4><p>REF: NOTEBOOK #4<br>Official tutorial</p>
<p>The following is basically…summery of the above processes</p>
<p>We load the raws into BIDS, crop &amp; filter and set events</p>
<p>finally we create projectors</p>
<pre class="line-numbers language-none"><code class="language-none">bids_root &#x3D; pathlib.Path(&#39;out_data&#x2F;sample_BIDS&#39;)

bids_path &#x3D; mne_bids.BIDSPath(subject&#x3D;&#39;01&#39;,
                              session&#x3D;&#39;01&#39;,
                              task&#x3D;&#39;audiovisual&#39;,
                              run&#x3D;&#39;01&#39;,
                              datatype&#x3D;&#39;meg&#39;,
                              root&#x3D;bids_root)
# MNE needs continuous data to work with, 
# so to create projecters we need to start with
# raw data again
raw &#x3D; mne_bids.read_raw_bids(bids_path)
raw.load_data()
raw.filter(l_freq&#x3D;0.1, h_freq&#x3D;40)

ecg_projs, ecg_events &#x3D; mne.preprocessing.compute_proj_ecg(raw, n_grad&#x3D;1, n_mag&#x3D;1, n_eeg&#x3D;0,
                                                           average&#x3D;True)

eog_projs, eog_events &#x3D; mne.preprocessing.compute_proj_eog(raw, n_grad&#x3D;1, n_mag&#x3D;1,n_eeg&#x3D;1, average&#x3D;True)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>And for ICA, we ceate EPOCHS and fit</p>
<pre class="line-numbers language-none"><code class="language-none">epochs_ica.info

n_components &#x3D; 0.8  # Should normally be higher, like 0.999!!
method &#x3D; &#39;picard&#39;
max_iter &#x3D; 100  # Should normally be higher, like 500 or even 1000!!
fit_params &#x3D; dict(fastica_it&#x3D;5)
random_state &#x3D; 42

ica &#x3D; mne.preprocessing.ICA(n_components&#x3D;n_components,
                            
                            method&#x3D;method,
                            max_iter&#x3D;max_iter,
                            fit_params&#x3D;fit_params,
                            random_state&#x3D;random_state)
ica.fit(epochs_ica)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">OUTPUT:
Method	picard
Fit parameters	fastica_it&#x3D;5
max_iter&#x3D;100
Fit	82 iterations on epochs (201920 samples)
ICA components	28
Available PCA components	364
Channel types	mag, grad, eeg
ICA components marked for exclusion	<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>(Output was in table format but im too lazy)</p>
<p>Then we can detect patterns and… plot scores or some</p>
<p>Try overlay to see the cleaning process really works:<br><img src="/img/overlay.png"></p>
<pre class="line-numbers language-none"><code class="language-none">epochs_cleaned&#x3D;ica.apply(epochs.copy())
epochs_cleaned.plot()
epochs.plot()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="Time-Frequency"><a href="#Time-Frequency" class="headerlink" title="Time Frequency"></a>Time Frequency</h2><h2 id="Classification"><a href="#Classification" class="headerlink" title="Classification"></a>Classification</h2><h2 id="Transformer"><a href="#Transformer" class="headerlink" title="Transformer"></a>Transformer</h2>
	  	  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a type="button" class="btn btn-default disabled"><i class="fa fa-arrow-circle-o-left"></i>Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2023/06/10/hackersmani_1/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>


	
	<!-- comment -->
	
		<section id="comments" style="margin:10px;padding:10px;background:#fff;">
		  <div id="vcomment" class="comment"></div> 
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script>
   var notify = 'true' == true ? true : false;
   var verify = 'false' == true ? true : false;
    window.onload = function() {
        new Valine({
            el: '.comment',
            notify: notify,
            verify: verify,
            app_id: "4UCwhumBRqjeYaJvb3Sx1URa-gzGzoHsz",
            app_key: "JrGdUqa7BaWGRmBkL8Swz2Ve",
            placeholder: "Just go go",
            avatar:"retro"
        });
    }
</script>

		</section>
	  

	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2024 Ariax
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.    
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
   </html>
